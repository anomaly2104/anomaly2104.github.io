---           
layout: post
title: Make different words in UITextView clickable in iOS
date: 2015-10-10 18:32:38 UTC
updated: 2015-10-10 18:32:38 UTC
comments: false
categories: Cocoa iOS Objective-C UITextView
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="background-color: white; border: 0px; clear: both; font-family: Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif; font-size: 14px; line-height: 18px; margin-bottom: 1em; padding: 0px; vertical-align: baseline;">Lets say you have a UITextView which displays an NSAttributedString. This string contains words that you'd like to make tappable, such that when they are tapped you get called back so that you can perform an action. you realise that UITextView can detect taps on a URL and call back my delegate, but these aren't URLs...</div><div style="background-color: white; border: 0px; clear: both; font-family: Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif; font-size: 14px; line-height: 18px; margin-bottom: 1em; padding: 0px; vertical-align: baseline;">But with iOS7 and the power of TextKit this is possible. Not only this is possible, but this can be done very easily also.</div><div style="background-color: white; border: 0px; clear: both; font-family: Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif; font-size: 14px; line-height: 18px; margin-bottom: 1em; padding: 0px; vertical-align: baseline;">Suppose we have some words starting with&nbsp;<strong style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">'@'</strong>&nbsp;or&nbsp;<strong style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">'#' </strong><span style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">in our textview</span>. You want to make these words clickable and on click you want to invoke some function.</div><div class="p1"><span class="s1">1. First of all, we will use red colour for words starting with '@', green for words starting with '#' and black for all the other. To do that, we can use following code:</span></div><div class="p1"><span class="s1">NSString</span> * <span class="s2">const</span> hashTagKey = <span class="s3">@"HashTag"</span>;</div><div class="p1"><span class="s1">NSString</span> * <span class="s2">const</span> userNameKey = <span class="s3">@"UserName"</span>;</div><div class="p1"><span class="s1">NSString</span> * <span class="s2">const</span> normalKey = <span class="s3">@"NormalKey"</span>;</div><div class="p1"><span class="s1">NSString</span> * <span class="s2">const</span> wordType = <span class="s3">@"WordType"</span>;</div><div class="p2"><br /></div><div class="p1">- (<span class="s1">NSAttributedString</span> *)attributedMessageFromMessage:(<span class="s1">NSString</span> *)message {</div><div class="p1">&nbsp; &nbsp; <span class="s1">NSArray</span>* messageWords = [message <span class="s2">componentsSeparatedByString</span>: <span class="s3">@" "</span>];</div><div class="p2"><span class="s4">&nbsp; &nbsp; </span>NSMutableAttributedString<span class="s4"> *attributedMessage = [[</span>NSMutableAttributedString<span class="s4"> </span><span class="s2">alloc</span><span class="s4">] </span><span class="s2">initWithString</span><span class="s4">:</span><span class="s3">@""</span><span class="s4">];</span></div><div class="p3">&nbsp;&nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; <span class="s5">for</span> (<span class="s1">NSString</span> *word <span class="s5">in</span> messageWords) {</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">NSDictionary</span> * attributes;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s5">if</span>([word <span class="s2">characterAtIndex</span>:<span class="s6">0</span>] == <span class="s6">'@'</span>){</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attributes = <span class="s6">@{</span><span class="s7">NSForegroundColorAttributeName</span>:[<span class="s1">UIColor</span> <span class="s2">redColor</span>],</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s8">wordType</span>: <span class="s8">userNameKey</span>,</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s8">userNameKey</span>:[word <span class="s2">substringFromIndex</span>:<span class="s6">1</span>]<span class="s6">}</span>;</div><div class="p3">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; } <span class="s5">else</span> <span class="s5">if</span>([word <span class="s2">characterAtIndex</span>:<span class="s6">0</span>] == <span class="s6">'#'</span>){</div><div class="p4"><span class="s4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attributes = </span><span class="s6">@{</span>NSForegroundColorAttributeName<span class="s4">:[</span><span class="s1">UIColor</span><span class="s4"> </span><span class="s2">colorWithRed</span><span class="s4">:</span><span class="s6">0.180392</span></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">green</span>:<span class="s6">0.545098</span></div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">blue</span>:<span class="s6">0.341176</span></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">alpha</span>:<span class="s6">1.0</span>],</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s8">wordType</span>: <span class="s8">hashTagKey</span>,</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s8">hashTagKey</span>:[word <span class="s2">substringFromIndex</span>:<span class="s6">1</span>]<span class="s6">}</span>;</div><div class="p3"><br /></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; } <span class="s5">else</span> {</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attributes = <span class="s6">@{</span><span class="s7">NSForegroundColorAttributeName</span>:[<span class="s1">UIColor</span> <span class="s2">blackColor</span>], <span class="s8">wordType</span>: <span class="s8">normalKey</span><span class="s6">}</span>;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; }</div><div class="p2"><span class="s4">&nbsp; &nbsp; &nbsp; &nbsp; </span>NSAttributedString<span class="s4"> * subString = [[</span>NSAttributedString<span class="s4"> </span><span class="s2">alloc</span><span class="s4">]</span></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">initWithString</span>:[<span class="s1">NSString</span> <span class="s2">stringWithFormat</span>:<span class="s3">@"%@ "</span>,word]</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">attributes</span>:attributes];</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; [attributedMessage <span class="s2">appendAttributedString</span>:subString];</div><div class="p1">&nbsp; &nbsp; }</div><div class="p1">&nbsp; &nbsp; <span class="s5">return</span> attributedMessage;</div><div class="p1"></div><div class="p1">}</div><div class="p1"><br /></div><div class="p1">2. After to make tapping enables, assign a UITapGestureRecognizer and its IBAction should look something like this:</div><div class="p1">- (<span class="s1">IBAction</span>)messageTapped:(<span class="s2">UITapGestureRecognizer</span> *)recognizer {</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">UITextView</span> *textView = (<span class="s2">UITextView</span> *)recognizer.<span class="s3">view</span>;</div><div class="p2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">NSLayoutManager</span> *layoutManager = textView.<span class="s3">layoutManager</span>;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s3">CGPoint</span> location = [recognizer <span class="s4">locationInView</span>:textView];</div><div class="p2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s3">NSUInteger</span> characterIndex;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; characterIndex = [layoutManager <span class="s4">characterIndexForPoint</span>:location</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s4">inTextContainer</span>:textView.<span class="s3">textContainer</span></div><div class="p3"><span class="s5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>fractionOfDistanceBetweenInsertionPoints<span class="s5">:</span><span class="s1">NULL</span><span class="s5">];</span></div><div class="p2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">if</span> (characterIndex &lt; textView.<span class="s3">textStorage</span>.<span class="s4">length</span>) {</div><div class="p2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s3">NSRange</span> range;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">id</span> wordType = [textView.<span class="s3">attributedText</span> <span class="s4">attribute</span>:<span class="s6">wordType</span></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s4">atIndex</span>:characterIndex</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s4">effectiveRange</span>:&amp;range];</div><div class="p2">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">if</span>([wordType <span class="s4">isEqualToString</span>:<span class="s6">userNameKey</span>]){</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">NSString</span> *userName = [textView.<span class="s3">attributedText</span> <span class="s4">attribute</span>:<span class="s6">userNameKey</span></div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s4">atIndex</span>:characterIndex</div><div class="p1">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s4">effectiveRange</span>:&amp;range];</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="s1">self</span> <span class="s7">openViewControllerForUserName</span>:userName];</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="s1">else</span> <span class="s1">if</span>([wordType <span class="s4">isEqualToString</span>:<span class="s6">hashTagKey</span>]){</div><div class="p4"><span class="s5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>// TODO: Segue to hashtag controller once it is in place.</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div class="p1">&nbsp; &nbsp; &nbsp; &nbsp; }</div><div class="p1"></div><div class="p1">}</div><div class="p1"><br /></div><div class="p1">Please comment if you have any suggestions or queries!!</div><div class="p1">Thanks</div></div>